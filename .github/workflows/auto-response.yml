name: Auto Response

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome-issue:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const issueAuthor = context.payload.issue.user.login;
            const isFirstIssue = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              creator: issueAuthor,
              state: 'all'
            }).then(res => res.data.length === 1);

            if (isFirstIssue) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: `Thanks for opening your first issue, @${issueAuthor}! ðŸŽ‰\n\nWe'll take a look as soon as we can. In the meantime:\n- Make sure you've provided steps to reproduce (for bugs)\n- Check the [Discussions](https://github.com/${context.repo.owner}/${context.repo.repo}/discussions) for Q&A\n- Review the [documentation](https://github.com/${context.repo.owner}/${context.repo.repo}#readme) if you haven't already`
              });
            }

  welcome-pr:
    if: github.event_name == 'pull_request_target'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const prAuthor = context.payload.pull_request.user.login;
            const isFirstPR = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all'
            }).then(res => res.data.filter(pr => pr.user.login === prAuthor).length === 1);

            if (isFirstPR) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: `Thanks for your first PR, @${prAuthor}! ðŸš€\n\nWe appreciate your contribution to CoWork-OSS. A maintainer will review this soon.\n\n**Reminder**: If this was built with AI tools (Claude Code, Codex, etc.), please note that in the PR description â€” AI-assisted PRs are welcome here!`
              });
            }
